<!-- pay.html — Halaman Pembayaran DANA/GoPay -->
<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Pembayaran | DANA / GoPay</title>
<style>
  :root{
    --bg:#f6f7fb;
    --card:#ffffff;
    --text:#1f2330;
    --muted:#6b7280;
    --line:#e9eaf0;
    --primary:#8f67e8;
    --primary-2:#6d58d7;
    --success:#10b981;
    --warning:#f59e0b;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;background:var(--bg);color:var(--text);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;
  }
  a{color:inherit;text-decoration:none}
  .container{max-width:980px;margin:0 auto;padding:16px}
  header{
    background:linear-gradient(90deg,#8a63d2,#b07cfb);
    color:#fff;
  }
  .nav{
    display:flex;gap:16px;align-items:center;justify-content:space-between;padding:14px 16px
  }
  .brand{display:flex;gap:10px;align-items:center;font-weight:700}
  .brand-badge{
    width:28px;height:28px;border-radius:8px;background:#fff;color:#8a63d2;
    display:grid;place-items:center;font-weight:900
  }
  .nav-links{display:flex;gap:18px;opacity:.95;font-weight:600}
  .search{display:flex;align-items:center;background:#fff;border-radius:999px;padding:6px 10px;gap:8px;min-width:180px}
  .search input{border:0;outline:0;width:100%;font-size:14px}
  main{padding:24px 0}
  .hero{
    height:180px;border-radius:14px;background:
      linear-gradient(180deg,rgba(0,0,0,.3),rgba(0,0,0,.15)),
      url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="400"><defs><linearGradient id="g" x1="0" y1="0" x2="1" y2="1"><stop stop-color="%23b07cfb"/><stop offset="1" stop-color="%238a63d2"/></linearGradient></defs><rect width="100%" height="100%" fill="url(%23g)"/><g fill="white" fill-opacity="0.25"><circle cx="120" cy="90" r="60"/><circle cx="360" cy="220" r="80"/><circle cx="880" cy="160" r="70"/></g></svg>');
    background-size:cover;background-position:center;
    display:flex;align-items:flex-end;padding:16px;color:#fff
  }
  .hero h1{margin:0;font-size:28px}
  .hero p{margin:2px 0 6px 0;opacity:.9}
  .grid{
    display:grid;grid-template-columns:1.2fr .9fr;gap:20px;margin-top:16px
  }
  .card{
    background:var(--card);border:1px solid var(--line);border-radius:12px;
    padding:20px;box-shadow:0 1px 1px rgba(20,20,40,.02),0 8px 24px rgba(20,20,40,.04)
  }
  .muted{color:var(--muted)}
  .center{text-align:center}
  .qr-wrap{display:flex;flex-direction:column;align-items:center;gap:12px}
  canvas.qr{width:220px;height:220px;border-radius:10px;border:1px solid var(--line);background:#fff}
  .pill{
    display:inline-flex;border:1px solid var(--line);border-radius:999px;overflow:hidden
  }
  .pill button{
    padding:10px 16px;border:0;background:#fff;color:var(--text);cursor:pointer;font-weight:700
  }
  .pill button.active{background:var(--primary);color:#fff}
  .btn{
    display:inline-flex;align-items:center;justify-content:center;gap:8px;
    padding:10px 14px;border-radius:10px;border:1px solid var(--line);background:#fff;
    cursor:pointer;font-weight:700
  }
  .btn.primary{background:var(--primary);color:#fff;border-color:transparent}
  .btn.ghost{background:#fff}
  .btn.warn{background:var(--warning);color:#111;border-color:transparent}
  .btn:disabled{opacity:.6;cursor:not-allowed}
  .row{display:flex;align-items:center;justify-content:space-between;padding:8px 0;border-bottom:1px dashed var(--line)}
  .row:last-child{border-bottom:0}
  .table{width:100%;border-collapse:collapse;margin-top:6px}
  .table th,.table td{padding:10px 6px;border-bottom:1px solid var(--line);text-align:left;font-size:14px}
  .table tfoot td{font-weight:800}
  .small{font-size:12px}
  .actions{display:flex;gap:10px;flex-wrap:wrap;justify-content:center}
  .countdown{font-weight:800;color:#ef4444}
  footer{margin-top:22px;color:var(--muted);font-size:13px}
  @media (max-width:900px){
    .grid{grid-template-columns:1fr}
    .hero{height:150px}
  }
</style>
</head>
<body>
<header>
  <div class="nav container">
    <div class="brand">
      <div class="brand-badge">E</div> EPIM 2025
    </div>
    <nav class="nav-links">
      <a href="#">Beranda</a><a href="#">Tentang</a><a href="#">Event</a><a href="#">Informasi</a>
    </nav>
    <div class="search">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M21 21l-4.2-4.2M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="#6b7280" stroke-width="2" stroke-linecap="round"/></svg>
      <input placeholder="Cari tiket..." aria-label="Cari">
    </div>
  </div>
</header>

<main class="container">
  <div class="hero">
    <div>
      <h1>Festival Tari Hardiknas</h1>
      <p>Haridiknas • Gedung Kesenian • 11 Agustus 2025</p>
    </div>
  </div>

  <div class="grid">
    <section class="card">
      <h3 class="center" style="margin:0 0 6px 0">Selesaikan Pembayaran via</h3>
      <div class="center">
        <div class="pill" role="tablist" aria-label="Pilih E-Wallet">
          <button id="btnDana" class="active" role="tab" aria-selected="true">DANA</button>
          <button id="btnGopay" role="tab" aria-selected="false">GoPay</button>
        </div>
      </div>
      <div class="qr-wrap" style="margin-top:14px">
        <canvas id="qr" class="qr" width="440" height="440" aria-label="Kode QR pembayaran"></canvas>
        <div class="muted small">Scan Kode QR di atas atau gunakan tombol berikut</div>
        <div class="actions">
          <button id="openApp" class="btn primary">Buka Aplikasi</button>
          <button id="dlQR" class="btn">Unduh Kode QR</button>
          <button id="copyCode" class="btn ghost" title="Salin Kode Pembayaran">Salin Kode</button>
        </div>
        <div class="small muted">Kedaluwarsa dalam <span class="countdown" id="countdown">15:00</span></div>
      </div>
    </section>

    <aside class="card">
      <div class="row">
        <div>
          <div style="font-weight:800">Ringkasan Pembayaran</div>
          <div class="small muted">No. Pesanan <span id="orderId"></span></div>
        </div>
        <div style="text-align:right">
          <div class="small muted">Total</div>
          <div style="font-weight:900" id="totalTop">Rp 0</div>
        </div>
      </div>

      <table class="table" aria-label="Rincian biaya">
        <thead>
          <tr><th>Item</th><th>Qty</th><th>Harga</th><th>Subtotal</th></tr>
        </thead>
        <tbody id="items"></tbody>
        <tfoot>
          <tr><td colspan="3">Local Tax</td><td id="taxCell">Rp 0</td></tr>
          <tr><td colspan="3">Biaya Platform</td><td id="feeCell">Rp 0</td></tr>
          <tr><td colspan="3">Total Keseluruhan</td><td id="totalCell">Rp 0</td></tr>
        </tfoot>
      </table>

      <div class="actions" style="margin-top:10px">
        <button id="markPaid" class="btn primary">Saya Sudah Bayar</button>
        <button id="markPending" class="btn warn">Tandai Pending</button>
        <button id="toInvoice" class="btn ghost">Lihat Invoice</button>
      </div>
      <div class="small muted" style="margin-top:8px">Dengan melanjutkan, Anda menyetujui S&K yang berlaku.</div>
    </aside>
  </div>

  <footer class="container">
    Disediakan oleh EPIM • Metode tersedia: DANA, GoPay
  </footer>
</main>

<script>
  // Util: format rupiah
  const rupiah = n => new Intl.NumberFormat('id-ID',{style:'currency',currency:'IDR',maximumFractionDigits:0}).format(n).replace(",00","");

  // Seed sample order into localStorage if absent
  const initialOrder = {
    id: 'INV-' + new Date().toISOString().slice(0,10).replaceAll('-','') + '-001',
    event: 'Festival Tari Hardiknas',
    date: 'Senin, 11 Agustus 2025',
    items: [{name:'Tiket Festival Tari Hardiknas', qty:1, price:50000}],
    tax: 16000,
    fee: 5000,
    method: 'DANA',
    status: 'unpaid',
    code: Math.random().toString(36).slice(2,10).toUpperCase(),
    expiresAt: Date.now() + 15*60*1000 // 15 minutes
  };
  const order = JSON.parse(localStorage.getItem('order')||'null') || initialOrder;
  localStorage.setItem('order', JSON.stringify(order));

  // Render order details
  document.getElementById('orderId').textContent = order.id;
  const itemsTbody = document.getElementById('items');
  let subtotal=0;
  itemsTbody.innerHTML = order.items.map(it=>{
    const sub = it.qty * it.price; subtotal+=sub;
    return `<tr><td>${it.name}</td><td>${it.qty}</td><td>${rupiah(it.price)}</td><td>${rupiah(sub)}</td></tr>`;
  }).join('');
  const total = subtotal + order.tax + order.fee;
  document.getElementById('taxCell').textContent = rupiah(order.tax);
  document.getElementById('feeCell').textContent = rupiah(order.fee);
  document.getElementById('totalCell').textContent = rupiah(total);
  document.getElementById('totalTop').textContent = rupiah(total);

  // Payment method tabs
  const btnDana = document.getElementById('btnDana');
  const btnGopay = document.getElementById('btnGopay');
  function setMethod(m){
    order.method=m;
    localStorage.setItem('order', JSON.stringify(order));
    btnDana.classList.toggle('active', m==='DANA');
    btnGopay.classList.toggle('active', m==='GoPay');
    drawFakeQR(document.getElementById('qr'), order.id+'-'+order.method+'-'+order.code);
  }
  btnDana.onclick=()=>setMethod('DANA');
  btnGopay.onclick=()=>setMethod('GoPay');

  // Fake-QR generator (no external libs) — nice-looking pattern + finder markers
  function drawFakeQR(canvas, seedStr){
    const ctx = canvas.getContext('2d');
    const size = canvas.width; // 440
    ctx.clearRect(0,0,size,size);
    ctx.fillStyle='#fff'; ctx.fillRect(0,0,size,size);

    // seeded RNG
    let h = 2166136261 >>> 0;
    for (let i=0;i<seedStr.length;i++){ h ^= seedStr.charCodeAt(i); h = Math.imul(h, 16777619); }
    let s = (h>>>0);
    const rand = ()=> (s = (s*1664525 + 1013904223)>>>0) / 0x100000000;

    const modules = 33; // includes quiet zone
    const cell = Math.floor(size/modules);
    const offset = Math.floor((size - cell*modules)/2);

    // draw modules
    ctx.fillStyle='#000';
    function drawFinder(ix,iy){
      // 7x7 outer, 5x5 inner, 3x3 core
      const x=offset+ix*cell,y=offset+iy*cell;
      ctx.fillStyle='#000'; ctx.fillRect(x,y,7*cell,7*cell);
      ctx.fillStyle='#fff'; ctx.fillRect(x+cell,y+cell,5*cell,5*cell);
      ctx.fillStyle='#000'; ctx.fillRect(x+2*cell,y+2*cell,3*cell,3*cell);
    }
    drawFinder(2,2);
    drawFinder(modules-9,2);
    drawFinder(2,modules-9);

    // timing-like patterns
    ctx.fillStyle='#000';
    for(let i=9;i<modules-9;i++){
      if(i%2===0){ // alternating
        ctx.fillRect(offset+i*cell, offset+6*cell, cell, cell);
        ctx.fillRect(offset+6*cell, offset+i*cell, cell, cell);
      }
    }
    // random data area
    for(let r=0;r<modules;r++){
      for(let c=0;c<modules;c++){
        const inFinder = (r>=2&&r<9&&c>=2&&c<9) || (r>=2&&r<9&&c>=modules-9&&c<modules-2) || (r>=modules-9&&r<modules-2&&c>=2&&c<9);
        const isTiming = (r===6 && c>=9 && c<modules-9) || (c===6 && r>=9 && r<modules-9);
        const quiet = (r<1||c<1||r>=modules-1||c>=modules-1);
        if(inFinder||isTiming||quiet) continue;
        if(rand()<0.45){
          ctx.fillStyle='#000';
          ctx.fillRect(offset+c*cell, offset+r*cell, cell, cell);
        }
      }
    }
    // small white logo in center
    const center = size/2;
    ctx.fillStyle='#fff';
    ctx.beginPath(); ctx.arc(center,center, cell*1.5, 0, Math.PI*2); ctx.fill();
    ctx.strokeStyle='#eee'; ctx.lineWidth=2; ctx.stroke();
    ctx.fillStyle='#8a63d2';
    ctx.beginPath(); ctx.arc(center,center, cell*0.9, 0, Math.PI*2); ctx.fill();
    ctx.fillStyle='#fff';
    ctx.font = `${cell*0.9}px system-ui,Arial`; ctx.textAlign='center'; ctx.textBaseline='middle';
    ctx.fillText(order.method==='DANA'?'D':'G', center, center+1);
  }
  drawFakeQR(document.getElementById('qr'), order.id+'-'+order.method+'-'+order.code);

  // Actions
  document.getElementById('openApp').onclick=()=>{
    alert('Mencoba membuka aplikasi ' + order.method + '...\n(Fitur demo)');
  };
  document.getElementById('dlQR').onclick=()=>{
    const a=document.createElement('a');
    a.download = `${order.method}-${order.id}-QR.png`;
    a.href = document.getElementById('qr').toDataURL('image/png');
    a.click();
  };
  document.getElementById('copyCode').onclick=async()=>{
    try{
      await navigator.clipboard.writeText(order.code);
      alert('Kode pembayaran disalin: '+order.code);
    }catch(e){ alert('Gagal menyalin'); }
  };
  document.getElementById('markPaid').onclick=()=>{
    order.status='paid';
    localStorage.setItem('order', JSON.stringify(order));
    location.href='success.html';
  };
  document.getElementById('markPending').onclick=()=>{
    order.status='pending';
    localStorage.setItem('order', JSON.stringify(order));
    location.href='pending.html';
  };
  document.getElementById('toInvoice').onclick=()=>location.href='invoice.html';

  // Countdown timer
  const elCd = document.getElementById('countdown');
  function tick(){
    const left = Math.max(0, order.expiresAt - Date.now());
    const m = Math.floor(left/60000), s = Math.floor((left%60000)/1000);
    elCd.textContent = String(m).padStart(2,'0')+':'+String(s).padStart(2,'0');
    if(left<=0){
      elCd.textContent = 'Kedaluwarsa';
      document.getElementById('markPaid').disabled=true;
      document.getElementById('markPending').disabled=true;
    } else {
      requestAnimationFrame(()=>setTimeout(tick,250));
    }
  }
  tick();
</script>
</body>
</html>